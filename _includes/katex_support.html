<!-- KaTeX CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">

<!-- KaTeX JavaScript -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>

<!-- KaTeX Auto-render Extension -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

<!-- Custom KaTeX Configuration -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
        // Delimiters (matching your MathJax setup)
        delimiters: [
            {left: '\\[', right: '\\]', display: true},   // Display math
            {left: '$', right: '$', display: false},      // Inline math
            {left: '\\(', right: '\\)', display: false}   // Inline math
        ],
        
        // Equation numbering (basic support)
        // Note: KaTeX doesn't have built-in equation numbering like MathJax
        // You'll need to use \tag{} manually for numbered equations
        
        // Error handling
        errorCallback: function(msg, err) {
            console.error('KaTeX Error:', msg);
            alert("Math Processing Error: " + msg);
        },
        
        // Process escapes (similar to MathJax processEscapes)
        fleqn: false,
        
        // Additional options
        throwOnError: false,  // Don't break on errors
        strict: false         // Allow more LaTeX constructs
    });
});
</script>

<!-- Optional: Custom styling for better equation display -->
<style>
.katex-display {
    margin: 1em 0;
    text-align: center;
}

.katex {
    font-size: 1.05em;
}

/* Style for manual equation numbering */
.equation-number {
    float: right;
    margin-top: 0.2em;
}
</style>
